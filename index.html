<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TaskMaster Pro ‚Äî To-Do List Moderne</title>

  <!-- Lien vers le manifest -->
  <link rel="manifest" href="manifest.json">

  <!-- Ic√¥ne -->
  <link rel="icon" type="image/x-icon" href="favicon.ico">

  <style>
    /* ==== BASE ==== */
    *{margin:0;padding:0;box-sizing:border-box;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    body{background:linear-gradient(135deg,#1e3c72 0%,#2a5298 50%,#7e22ce 100%);color:#0f172a;-webkit-font-smoothing:antialiased;}

    /* ==== NAVBAR ==== */
    .navbar{display:flex;justify-content:space-between;align-items:center;padding:14px 28px;background:rgba(255,255,255,0.9);backdrop-filter:blur(8px);position:sticky;top:0;z-index:50;border-radius:0 0 16px 16px;box-shadow:0 6px 18px rgba(2,6,23,0.15);}
    .logo{display:flex;gap:12px;align-items:center;font-weight:800;color:#0ea5e9;}
    .logo-icon{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;color:white;font-weight:800;background:linear-gradient(135deg,#3b82f6,#8b5cf6);box-shadow:0 6px 18px rgba(59,130,246,0.25);}
    .user-profile{display:flex;gap:10px;align-items:center;padding:6px 12px;background:#f1f5f9;border-radius:999px}
    .avatar{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;background:linear-gradient(135deg,#3b82f6,#8b5cf6);font-weight:700}

    /* ==== LAYOUT ==== */
    .container{max-width:1300px;margin:22px auto;padding:18px}
    .main-layout{display:grid;grid-template-columns:320px 1fr;gap:22px}
    @media (max-width:980px){.main-layout{grid-template-columns:1fr;padding:0 12px}}

    /* ==== SIDEBAR ==== */
    .sidebar{background:rgba(255,255,255,0.95);padding:20px;border-radius:16px;box-shadow:0 12px 40px rgba(2,6,23,0.18)}
    .sidebar-title{font-size:12px;color:#64748b;font-weight:800;text-transform:uppercase;margin-bottom:12px;letter-spacing:0.6px}
    .category-list{display:flex;flex-direction:column;gap:8px;max-height:48vh;overflow:auto;padding-right:6px}
    .category-item{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-radius:10px;color:#0f172a;font-weight:700;cursor:pointer;transition:all .18s;position:relative}
    .category-item:hover{transform:translateX(4px);background:#f1f5f9}
    .category-item.active{background:linear-gradient(90deg,#3b82f6,#8b5cf6);color:white;box-shadow:0 8px 24px rgba(59,130,246,0.16)}
    .delete-list{position:absolute;right:8px;top:50%;transform:translateY(-50%);color:#ef4444;border:none;background:transparent;font-weight:800;display:none}
    .category-item:hover .delete-list{display:block}

    /* ==== MAIN ==== */
    .main-content{background:rgba(255,255,255,0.98);padding:22px;border-radius:16px;box-shadow:0 12px 40px rgba(2,6,23,0.12);min-height:60vh}
    .task-input-section{background:#f8fafc;padding:14px;border-radius:12px;border:2px dashed rgba(203,213,225,0.9);display:flex;flex-direction:column;gap:10px}
    .task-row{display:flex;gap:10px}
    #taskInput{flex:1;padding:12px;border-radius:10px;border:2px solid #e6edf6;font-size:14px}
    #taskInput:focus{outline:none;box-shadow:0 6px 20px rgba(59,130,246,0.08);border-color:#3b82f6}
    select,input[type="datetime-local"]{padding:10px;border-radius:10px;border:2px solid #e6edf6}
    .btn{padding:10px 14px;border-radius:10px;border:none;font-weight:800;color:white;background:linear-gradient(90deg,#3b82f6,#8b5cf6);cursor:pointer;transition:0.2s}
    .btn:active{transform:scale(.98)}

    /* ==== TASKS ==== */
    .task-list{margin-top:12px;display:flex;flex-direction:column;gap:12px}
    .task-item{display:grid;grid-template-columns:38px 1fr 120px 60px 70px;gap:12px;align-items:center;padding:12px;border-radius:12px;background:white;border:1px solid #f1f5f9;opacity:0;transform:translateY(18px);animation:appear .45s forwards;transition:background .3s}
    @keyframes appear{to{opacity:1;transform:none}}
    .checkbox{width:34px;height:34px;border-radius:8px;border:2px solid #e6edf6;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .25s ease}
    .checkbox.checked{background:linear-gradient(90deg,#3b82f6,#8b5cf6);border-color:transparent;color:white;transform:scale(1.1)}
    .task-content{display:flex;flex-direction:column;gap:6px;transition:0.3s}
    .task-text{font-weight:800;transition:all .3s}
    .task-item.done .task-text{text-decoration:line-through;color:#9ca3af;opacity:0.7;transition:all .3s}
    .task-meta{font-size:13px;color:#64748b;display:flex;gap:10px;flex-wrap:wrap}
    .task-priority{padding:6px 10px;border-radius:999px;font-weight:800;font-size:13px}
    .task-priority.low{background:#dbeafe;color:#2563eb}
    .task-priority.med{background:#fef3c7;color:#f59e0b}
    .task-priority.high{background:#fee2e2;color:#dc2626}
    .task-due{padding:6px 10px;border-radius:999px;background:#fff3e0;color:#92400e;font-weight:700;font-size:13px;transition:color .3s}
    .task-actions{display:flex;gap:8px;align-items:center}
    .action-btn{padding:8px;border-radius:10px;border:none;cursor:pointer;font-weight:800}
    .delete-btn{background:#fee2e2;color:#b91c1c}
    .delete-btn:hover{background:#dc2626;color:white}
    .empty{padding:40px;text-align:center;color:#94a3b8}

    /* ==== TOAST ==== */
    .toast-wrap{position:fixed;right:20px;bottom:20px;z-index:9999;display:flex;flex-direction:column;gap:8px}
    .toast{background:rgba(2,6,23,0.95);color:white;padding:10px 14px;border-radius:10px;box-shadow:0 8px 24px rgba(2,6,23,0.32);opacity:0;transform:translateY(10px);animation:toastIn .36s forwards}
    @keyframes toastIn{to{opacity:1;transform:none}}
  </style>
</head>
<body>

<nav class="navbar">
  <div class="logo"><div class="logo-icon">‚úì</div>TaskMaster Pro</div>
  <div class="user-profile"><div class="avatar">JD</div>John Doe</div>
</nav>

<div class="container">
  <div class="main-layout">
    <aside class="sidebar">
      <div class="sidebar-title">Listes</div>
      <ul class="category-list" id="listSidebar"></ul>
      <div style="margin-top:12px;display:flex;gap:8px">
        <input id="newListInput" placeholder="Nouvelle liste..." style="flex:1;padding:8px;border-radius:8px;border:1px solid #e6edf6" />
        <button id="addListBtn" class="btn" style="padding:8px 10px">+</button>
      </div>
    </aside>

    <main class="main-content">
      <section class="task-input-section">
        <div class="task-row">
          <input id="taskInput" placeholder="Nouvelle t√¢che..." />
          <button id="addBtn" class="btn">Ajouter</button>
        </div>
        <div class="task-options">
          <select id="prioritySelect">
            <option value="low">üîµ Basse</option>
            <option value="med">üü° Moyenne</option>
            <option value="high">üî¥ Haute</option>
          </select>
          <input id="dueInput" type="datetime-local" />
          <select id="listSelect"></select>
        </div>
      </section>

      <ul class="task-list" id="taskList"></ul>
      <div id="emptyState" class="empty">Aucune t√¢che</div>
    </main>
  </div>
</div>

<div class="toast-wrap" id="toastWrap"></div>

<script>
  /* ==== LOGIQUE JS ==== */
  let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
  let lists = JSON.parse(localStorage.getItem('lists')) || ['Tout'];
  let currentList = 'Tout';

  const listSidebar=document.getElementById('listSidebar');
  const listSelect=document.getElementById('listSelect');
  const taskList=document.getElementById('taskList');
  const emptyState=document.getElementById('emptyState');
  const toastWrap=document.getElementById('toastWrap');
  const dueInput=document.getElementById('dueInput');
  const newListInput=document.getElementById('newListInput');
  const addListBtn=document.getElementById('addListBtn');
  const taskInput=document.getElementById('taskInput');
  const addBtn=document.getElementById('addBtn');
  const prioritySelect=document.getElementById('prioritySelect');

  function save(){localStorage.setItem('tasks',JSON.stringify(tasks));localStorage.setItem('lists',JSON.stringify(lists));}
  function showToast(msg){const t=document.createElement('div');t.className='toast';t.textContent=msg;toastWrap.appendChild(t);setTimeout(()=>{t.style.opacity='0'},2000);setTimeout(()=>t.remove(),2500);}
  function setMinDue(){const now=new Date();dueInput.min=now.toISOString().slice(0,16);}setMinDue();

  function renderLists(){
    listSidebar.innerHTML='';listSelect.innerHTML='';
    lists.forEach(list=>{
      const li=document.createElement('li');
      li.className='category-item'+(list===currentList?' active':'');
      li.textContent=list;
      li.onclick=()=>{currentList=list;renderLists();renderTasks();}
      if(list!=='Tout'){const del=document.createElement('button');del.className='delete-list';del.textContent='√ó';del.onclick=(e)=>{e.stopPropagation();lists=lists.filter(l=>l!==list);tasks=tasks.filter(t=>t.list!==list);if(currentList===list)currentList='Tout';save();renderLists();renderTasks();showToast('Liste supprim√©e');};li.appendChild(del);}
      const opt=document.createElement('option');opt.value=list;opt.textContent=list;listSelect.appendChild(opt);
      listSidebar.appendChild(li);
    });
  }
  addListBtn.onclick=()=>{const name=newListInput.value.trim();if(!name||lists.includes(name))return;lists.push(name);save();renderLists();newListInput.value='';};

  function formatCountdownISO(dueISO){if(!dueISO)return'';const diff=new Date(dueISO)-new Date();if(diff<=0)return'Termin√©';const d=Math.floor(diff/86400000);const h=Math.floor((diff%86400000)/3600000);const m=Math.floor((diff%3600000)/60000);return `${d}j ${h}h ${m}m`;}
  function countdownColor(dueISO){if(!dueISO)return'#475569';const diff=new Date(dueISO)-new Date();if(diff<=0)return'#6b7280';if(diff<=3600000)return'#dc2626';if(diff<=10800000)return'#f59e0b';return'#10b981';}

  function renderTasks(){
    taskList.innerHTML='';const visible=tasks.filter(t=>currentList==='Tout'||t.list===currentList);
    emptyState.style.display=visible.length?'none':'block';
    visible.forEach(t=>{
      const li=document.createElement('li');li.className='task-item'+(t.done?' done':'');
      const cb=document.createElement('div');cb.className='checkbox'+(t.done?' checked':'');cb.onclick=()=>{t.done=!t.done;save();renderTasks();};
      const content=document.createElement('div');content.className='task-content';
      const title=document.createElement('div');title.className='task-text';title.textContent=t.title;
      const meta=document.createElement('div');meta.className='task-meta';
      const created=document.createElement('span');created.textContent='Cr√©√©e: '+new Date(t.created).toLocaleString();meta.appendChild(created);
      if(t.due){const due=document.createElement('span');due.dataset.due=t.due;due.textContent=formatCountdownISO(t.due);due.style.color=countdownColor(t.due);meta.appendChild(due);}
      content.append(title,meta);
      const pr=document.createElement('div');pr.className='task-priority '+t.priority;pr.textContent=t.priority.toUpperCase();
      const dueLbl=document.createElement('div');dueLbl.className='task-due';dueLbl.textContent=t.due?formatCountdownISO(t.due):'';if(t.done||formatCountdownISO(t.due)==='Termin√©')dueLbl.textContent='Termin√©';
      const actions=document.createElement('div');actions.className='task-actions';
      const del=document.createElement('button');del.className='action-btn delete-btn';del.textContent='üóë';del.onclick=()=>{tasks=tasks.filter(x=>x!==t);save();renderTasks();};
      actions.appendChild(del);
      li.append(cb,content,pr,dueLbl,actions);
      taskList.appendChild(li);
    });
  }

  addBtn.onclick=()=>{const title=taskInput.value.trim();if(!title)return;tasks.push({title,created:new Date().toISOString(),due:dueInput.value||null,priority:prioritySelect.value,list:listSelect.value||'Tout',done:false});taskInput.value='';dueInput.value='';prioritySelect.value='low';save();renderTasks();};

  setInterval(()=>{document.querySelectorAll('.task-due').forEach(el=>{const li=el.closest('.task-item');const t=tasks.find(x=>x.title===li.querySelector('.task-text').textContent);if(!t)return;el.textContent=t.done?'Termin√©':(t.due?formatCountdownISO(t.due):'');el.style.color=countdownColor(t.due);});},1000);

  renderLists();renderTasks();

  /* ==== ENREGISTREMENT DU SERVICE WORKER ==== */
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./service-worker.js')
              .then(() => console.log('‚úÖ Service Worker enregistr√©'))
              .catch(err => console.error('‚ùå Erreur SW:', err));
    });
  }
</script>

</body>
</html>
